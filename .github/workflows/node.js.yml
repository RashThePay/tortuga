name: Deploy to Vercel

on:
  push:
    branches: [ "main" ]

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
    - uses: actions/checkout@v4

    - name: Install Vercel CLI
      run: npm i -g vercel

    - name: Deploy to Vercel
      id: deploy
      run: |
        DEPLOY_URL=$(vercel --prod --token ${{ secrets.VERCEL_TOKEN }} --yes)
        echo "url=$DEPLOY_URL" >> "$GITHUB_OUTPUT"
      env:
        VERCEL_ORG_ID: ${{ secrets.VERCEL_ORG_ID }}
        VERCEL_PROJECT_ID: ${{ secrets.VERCEL_PROJECT_ID }}

    - name: Set Telegram webhook
      run: |
        curl -s "https://api.telegram.org/bot${BOT_TOKEN}/setWebhook?url=${{ steps.deploy.outputs.url }}/api/webhook"
      env:
        BOT_TOKEN: ${{ secrets.BOT_TOKEN }}
